{% extends 'employee/employee_base.html' %}
{% block content %}
<div class="p-8 space-y-10">

  <!-- Ti√™u ƒë·ªÅ -->
  <div class="flex justify-between items-center">
    <h1 class="text-2xl font-semibold text-gray-800">
      üì• Phi·∫øu nh·∫≠p kho: <span class="text-blue-600 font-bold">C·ª≠a h√†ng ch√≠nh</span>
    </h1>
  </div>

  <!-- Form t·∫°o phi·∫øu nh·∫≠p -->
  <div class="bg-white border border-gray-200 rounded-2xl shadow p-6 space-y-6">
    <form method="POST">
      {% csrf_token %}

      <!-- Th√¥ng tin phi·∫øu -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">M√£ phi·∫øu nh·∫≠p</label>
          <input type="text" name="import_code" placeholder="T·ª± ƒë·ªông t·∫°o khi l∆∞u"
                 class="w-full border border-gray-300 rounded-xl p-2.5 bg-gray-50 text-gray-600" readonly>
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Ng√†y nh·∫≠p</label>
          <input type="text" name="import_date" value="{{ today|date:'d/m/Y' }}"
                 class="w-full border border-gray-300 rounded-xl p-2.5 focus:ring-2 focus:ring-blue-400">
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Nh√† cung c·∫•p</label>
          <select name="supplier"
                  class="w-full border border-gray-300 rounded-xl p-2.5 focus:ring-2 focus:ring-blue-400">
            <option value="">-- Ch·ªçn nh√† cung c·∫•p --</option>
            {% for supplier in suppliers %}
              <option value="{{ supplier.id }}">{{ supplier.name }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Nh√¢n vi√™n nh·∫≠p</label>
          <input type="text" name="employee" value="{{ request.user.get_full_name }}"
                 class="w-full border border-gray-300 rounded-xl p-2.5 bg-gray-50 text-gray-700" readonly>
        </div>
        <div class="md:col-span-2">
          <label class="block text-sm font-semibold text-gray-700 mb-2">Ghi ch√∫</label>
          <textarea name="note" rows="3" placeholder="V√≠ d·ª•: nh·∫≠p h√†ng t·ª´ NCC A..."
                    class="w-full border border-gray-300 rounded-xl p-2.5 focus:ring-2 focus:ring-blue-400 resize-none"></textarea>
        </div>
      </div>

      <!-- Danh s√°ch s·∫£n ph·∫©m -->
      <div>
        <h3 class="text-lg font-semibold text-blue-700 mt-6 mb-3">Danh s√°ch s·∫£n ph·∫©m nh·∫≠p</h3>

        <table class="w-full text-sm border border-gray-200 rounded-lg overflow-hidden">
          <thead class="bg-gray-50 text-gray-700 font-semibold">
            <tr>
              <th class="px-4 py-2 border-b">#</th>
              <th class="px-4 py-2 border-b">S·∫£n ph·∫©m</th>
              <th class="px-4 py-2 border-b text-right">S·ªë l∆∞·ª£ng</th>
              <th class="px-4 py-2 border-b text-right">ƒê∆°n gi√° (VNƒê)</th>
              <th class="px-4 py-2 border-b text-right">Th√†nh ti·ªÅn</th>
            </tr>
          </thead>
          <tbody id="product-rows">
            <tr>
              <td class="px-4 py-2 border-b text-gray-600">1</td>
              <td class="px-4 py-2 border-b">
                <select name="product[]" class="w-full border border-gray-300 rounded-lg p-1.5 focus:ring-2 focus:ring-blue-400">
                  <option value="">-- Ch·ªçn s·∫£n ph·∫©m --</option>
                  {% for product in products %}
                    <option value="{{ product.id }}">{{ product.product_name }}</option>
                  {% endfor %}
                </select>
              </td>
              <td class="px-4 py-2 border-b">
                <input type="number" name="quantity[]" min="1" value="1"
                       class="w-full text-right border border-gray-300 rounded-lg p-1.5 focus:ring-2 focus:ring-blue-400">
              </td>
              <td class="px-4 py-2 border-b">
                <input type="number" name="unit_price[]" min="0" step="100"
                       class="w-full text-right border border-gray-300 rounded-lg p-1.5 focus:ring-2 focus:ring-blue-400">
              </td>
              <td class="px-4 py-2 border-b text-right text-gray-600">0</td>
            </tr>
          </tbody>
        </table>

        <div class="flex justify-end mt-3">
          <button type="button" id="add-row"
                  class="px-3 py-1.5 text-sm bg-gray-100 border border-gray-300 rounded-lg hover:bg-gray-200 transition">
            ‚ûï Th√™m s·∫£n ph·∫©m
          </button>
        </div>
      </div>

      <!-- T·ªïng c·ªông -->
      <div class="flex justify-end mt-6 border-t border-gray-200 pt-4">
        <div class="text-right">
          <p class="text-gray-600 text-sm">T·ªïng gi√° tr·ªã:</p>
          <p class="text-lg font-semibold text-blue-700" id="total-amount">0 VNƒê</p>
        </div>
      </div>

      <!-- N√∫t l∆∞u -->
      <div class="flex justify-end pt-4 border-t border-gray-200">
        <button type="submit"
                class="px-6 py-2.5 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 hover:shadow-md transition-all">
          üíæ L∆∞u phi·∫øu nh·∫≠p
        </button>
      </div>
    </form>
  </div>

  <!-- B·∫£ng danh s√°ch phi·∫øu nh·∫≠p -->
  <div class="bg-white border border-gray-200 rounded-2xl shadow overflow-hidden">
    <div class="p-4 border-b bg-gray-50 font-semibold text-gray-800">
      üìÑ Danh s√°ch phi·∫øu nh·∫≠p g·∫ßn ƒë√¢y
    </div>
    <table class="w-full border-collapse">
      <thead class="bg-gray-50 text-gray-700 text-sm font-semibold border-b">
        <tr>
          <th class="p-3 text-left">M√£ phi·∫øu</th>
          <th class="p-3 text-left">Nh√† cung c·∫•p</th>
          <th class="p-3 text-left">Ng√†y nh·∫≠p</th>
          <th class="p-3 text-right">T·ªïng gi√° tr·ªã</th>
          <th class="p-3 text-center">Thao t√°c</th>
        </tr>
      </thead>
      <tbody class="text-gray-700 text-sm">
        {% for import in imports %}
        <tr class="border-b hover:bg-gray-50 transition">
          <td class="p-3 font-medium text-blue-600">{{ import.code }}</td>
          <td class="p-3">{{ import.supplier.name }}</td>
          <td class="p-3">{{ import.date|date:"d/m/Y" }}</td>
          <td class="p-3 text-right">{{ import.total_value|floatformat:0 }}‚Ç´</td>
          <td class="p-3 text-center">
            <a href="{% url 'inventory_import_edit' import.id %}" class="text-blue-600 hover:underline">S·ª≠a</a>
            <a href="{% url 'inventory_import_delete' import.id %}" class="text-red-500 hover:underline ml-2">X√≥a</a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="5" class="text-center text-gray-500 py-6">Ch∆∞a c√≥ phi·∫øu nh·∫≠p n√†o</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- JS th√™m d√≤ng s·∫£n ph·∫©m -->
<script>
document.getElementById("add-row").addEventListener("click", function() {
  const tableBody = document.getElementById("product-rows");
  const rowCount = tableBody.rows.length + 1;
  const newRow = tableBody.rows[0].cloneNode(true);
  newRow.querySelectorAll("input, select").forEach(el => el.value = "");
  newRow.querySelector("td").innerText = rowCount;
  tableBody.appendChild(newRow);
});
</script>
{% endblock %}