{% extends 'user_temp/base.html' %}
{% load static %}
<!-- Css -->
{% block extra_css %}
    <style>
        /* Banners */
        .hero-banner, .featured-banner {
            width: 100%;
            max-height: 400px;
            overflow: hidden;
            padding: 0px 100px;
        }
        
        .hero-banner img, .featured-banner img {
            width: 100%;
            object-fit: cover;
            margin-top:90px;
        }
        
        /* Category Section */
        .category-item img {
            width: 100%;
            /* height: 100px; */
            border: 2px solid #ddd;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .category-item a:hover img {
            transform: scale(1.05);
        }
        
        /* Product Section */
        .product-title {
            background-color: #232F3E;
            color: white;
            display: block;
            padding: 12px 20px;
            margin: 0 auto 30px;
            font-size: 18px;
            max-width: 800px;
            text-align: center;
            border-radius: 0;
            font-weight: 600;
        }
        
        .product-card {
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
            position: relative;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
        }
        
        .product-image {
            width: 100%;
            height: 200px;
            background-color: #eee;
            position: relative;
            overflow: hidden;
        }
        
        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .product-info {
            width: 100%;
            text-align: center;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .add-to-cart {
            display: block;
            width: 100%;
            background-color: #135fb1;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 0;
            text-decoration: none;
            text-align: center;
            font-weight: 500;
            margin-top: 0;
            transition: background-color 0.3s ease;
        }
        
        .add-to-cart:hover {
            background-color: #0d4a8a;
            color: white !important;
            text-decoration: none !important;
        }
        
        .product-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .product-price {
            color: #dc3545;
        }
        
        .view-more {
            border: 2px solid #135fb1;
            color: #135fb1;
            background-color: transparent;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
        }
        
        .view-more:hover {
            background-color: #135fb1;
            color: white;
            text-decoration: none;
        }
    </style>
{% endblock %}
{% block content %}
<div class="hero-banner">
    <img src="{% static 'images/image.jpg' %}" alt="Library">
  </div>

  <div class="container my-5">
      <h2 class="text-center mb-4">BỘ SƯU TẬP</h2>
      <div class="row text-center">
          {% for category in categories %}
          <div class="col-md-4 category-item">
              <a href="{% url 'category_detail' category.id %}">
                  <img src="{% static 'images/image.jpg' %}" alt="{{ category.category_name }}">
                  <p class="mt-2">{{ category.category_name|upper }}</p>
              </a>
          </div>
          {% empty %}
          <div class="col-12">
              <p class="text-center">Chưa có danh mục nào</p>
          </div>
          {% endfor %}
      </div>
  </div>

  {% for item in categories_with_products %}
  <div class="container my-5 product-section {% if forloop.first %}mb-auto{% endif %}">
      <h2 class="text-center product-title">{{ item.category.category_name|upper }}</h2>
      <div class="row">
          {% for product in item.products %}
          <div class="col-6 col-md-3 text-center mb-4">
              <div class="product-card">
                  <div class="product-image">
                      <a href="{% url 'product_detail_user' product.id %}">
                          {% if product.image %}
                              <img src="{{ product.image.url }}" alt="{{ product.product_name }}">
                          {% else %}
                              <img src="{% static 'images/image.jpg' %}" alt="{{ product.product_name }}">
                          {% endif %}
                      </a>
                  </div>
                  <a href="{% url 'add_to_cart' product.id %}" class="add-to-cart">Thêm vào giỏ hàng</a>
                  <div class="product-info">
                      <a href="{% url 'product_detail_user' product.id %}" style="text-decoration: none; color: inherit;">
                          <p class="product-name">{{ product.product_name }}</p>
                      </a>
                      <p class="product-price">{{ product.sell_price|floatformat:0 }} VND</p>
                  </div>
              </div>
          </div>
          {% empty %}
          <div class="col-12">
              <p class="text-center">Chưa có sản phẩm nào trong danh mục này</p>
          </div>
          {% endfor %}
      </div>
      <div class="text-center mb-4">
          <a href="{% url 'category_detail' item.category.id %}" class="btn btn-outline-dark view-more">Xem thêm các ấn bản {{ item.category.category_name|upper }}</a>
      </div>
  </div>

  {% if not forloop.last %}
  <div class="featured-banner my-5">
      <img src="{% static 'images/image.jpg' %}" alt="Open magic book">
  </div>
  {% endif %}
  {% empty %}
  <div class="container my-5">
      <p class="text-center">Chưa có danh mục và sản phẩm nào</p>
  </div>
  {% endfor %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Format giá với dấu chấm phân cách hàng nghìn
    const priceElements = document.querySelectorAll('.product-price');
    priceElements.forEach(function(element) {
        const text = element.textContent.trim();
        const match = text.match(/(\d+)\s*VND/);
        if (match) {
            const number = parseInt(match[1]);
            const formatted = number.toLocaleString('vi-VN');
            element.textContent = formatted + ' VND';
        }
    });
});
</script>
{% endblock %}