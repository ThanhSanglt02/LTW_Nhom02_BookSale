{% extends "admin_temp/admin_base.html" %}
{% load static %}

{% block content %}
<main class="flex-1 p-8">

    <!-- Thông báo -->
    {% if messages %}
        {% for message in messages %}
            <div class="alert-message p-4 mb-4 text-sm
                        {% if 'success' in message.tags %}text-green-800 bg-green-100 border border-green-400
                        {% elif 'warning' in message.tags %}text-yellow-800 bg-yellow-100 border border-yellow-400
                        {% else %}text-red-800 bg-red-100 border border-red-400{% endif %}
                        rounded-lg shadow" role="alert">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <!-- Header + nút thêm -->
    <div class="flex justify-between items-center mb-4">
        <h1 class="text-2xl font-semibold">Thể loại </h1>
        <a href="{% url 'genre_add' %}" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
            + Thêm Thể loại
        </a>
    </div>

    <!-- Form tìm kiếm -->
    <form method="get" class="flex items-center space-x-2 mb-6 p-4 bg-gray-50 border border-gray-300 rounded shadow-sm">
        <input type="text" name="search" placeholder="Tìm kiếm thể loại..."
               value="{{ search }}"
               class="bg-white border border-gray-300 rounded px-3 py-2 flex-1 focus:outline-none focus:ring-1 focus:ring-blue-300" />
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
            Tìm kiếm
        </button>
        {% if search %}
            <a href="{% url 'genre_list' %}" class="text-gray-600 hover:text-red-600 px-3 py-2">Xóa tìm kiếm</a>
        {% endif %}
    </form>

    <!-- Table danh sách thể loại -->
    <form method="POST" action="{% url 'genre_bulk_delete' %}">
        {% csrf_token %}
        <div class="bg-white shadow rounded-lg overflow-x-auto w-full">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="bg-gray-100 border-b">
                        <th class="p-3 w-12 text-center"><input type="checkbox" id="select_all_genres"></th>
                        <th class="p-3">ID</th>
                        <th class="p-3">Tên Thể loại</th>
                        <th class="p-3">Mô tả</th>
                    </tr>
                </thead>
                <tbody>
                    {% for g in genres %}
                    <tr class="border-b hover:bg-gray-50 cursor-pointer"
                        onclick="window.location.href='{% url 'genre_detail' g.id %}'">
                        <td class="p-3 text-center" onclick="event.stopPropagation()">
                            <input type="checkbox" name="genre_ids" value="{{ g.id }}" class="genre-checkbox">
                        </td>
                        <td class="p-3">{{ g.id }}</td>
                        <td class="p-3 font-semibold">{{ g.genre_name }}</td>
                        <td class="p-3 text-gray-600 truncate max-w-sm">{{ g.description|default:"Chưa có mô tả" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="text-center p-4 text-gray-500">Chưa có thể loại nào.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <br>
        <div class="mt-4 flex justify-start">
            <button type="submit" class="bg-blue-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded"
                    onclick="return confirm('Bạn có chắc chắn muốn xóa các thể loại đã chọn không?');">
                Xóa Thể Loại Đã Chọn
            </button>
        </div>
    </form>
</main>

<script>
    // Logic Select All
    document.getElementById('select_all_genres').addEventListener('click', function(e) {
        var checkboxes = document.querySelectorAll('.genre-checkbox');
        checkboxes.forEach(function(cb) {
            cb.checked = e.target.checked;
        });
    });

    // Ẩn thông báo sau 3 giây
    setTimeout(function() {
        var alerts = document.querySelectorAll('.alert-message');
        alerts.forEach(function(alert) {
            alert.style.display = 'none';
        });
    }, 3000);
</script>

{% endblock %}
